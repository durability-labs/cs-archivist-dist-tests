services:
  archivist-base:
    image: durabilitylabs/archivist-node:latest-dist-tests
    pull_policy: always
    command:
      - archivist
      - persistence
    environment:
      - NETWORK=testnet
      - ARCHIVIST_DATA_DIR=/data
      - ARCHIVIST_LOG_LEVEL=TRACE;warn:discv5,providers,manager,cache;warn:libp2p,multistream,switch,transport,tcptransport,semaphore,asyncstreamwrapper,lpstream,mplex,mplexchannel,noise,bufferstream,mplexcoder,secure,chronosstream,connection,connmanager,websock,ws-session
      - ARCHIVIST_API_BINDADDR=0.0.0.0
      - ARCHIVIST_API_CORS_ORIGIN=*
      - ARCHIVIST_STORAGE_QUOTA=20gb
      - NAT_PUBLIC_IP_AUTO=https://ip.archivist.storage
      - ARCHIVIST_ETH_PROVIDER=http://rpc-arbitrum

      # Fast cleanup:
      # TTL 3 hours
      # 1000 blocks every minute
      - ARCHIVIST_BLOCK_TTL=10800
      - ARCHIVIST_BLOCK_MI=60
      - ARCHIVIST_BLOCK_MN=1000
    logging:
      driver: json-file
      options:
        max-size: 100m
        max-file: 5
    extra_hosts:
      - rpc-arbitrum:host-gateway
